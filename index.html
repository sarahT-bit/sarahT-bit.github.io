<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS Tutoring App</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif;
      background: #f0f0f0; display: flex; flex-direction: column;
    }
    header {
      background: #222; color: white; padding: 15px; font-size: 1.5rem; text-align: center;
    }
    #container {
      flex: 1; display: flex; height: calc(100vh - 56px);
    }
    #sidebar {
      width: 150px; background: #333; color: white; display: flex; flex-direction: column;
    }
    #sidebar button {
      background: none; border: none; color: white; padding: 15px; font-size: 1rem; cursor: pointer;
      border-bottom: 1px solid #444; text-align: left;
    }
    #sidebar button:hover, #sidebar button.active {
      background: #555;
    }
    #mainContent {
      flex: 1; background: white; position: relative; padding: 10px; display: flex; flex-direction: column;
    }
    #videoChatContainer {
      position: fixed;
      top: 60px; right: 10px; width: 300px; height: 450px;
      background: #222; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.3);
      display: flex; flex-direction: column; color: white; z-index: 10;
    }
    #videoContainer {
      flex: 1; display: flex; flex-direction: row; gap: 5px; padding: 5px; background: #000;
    }
    #videoContainer video {
      flex: 1; border-radius: 5px; background: black; object-fit: cover;
    }
    #chatContainer {
      height: 180px; background: #111; display: flex; flex-direction: column;
    }
    #chatMessages {
      flex: 1; overflow-y: auto; padding: 10px; font-size: 0.9rem;
    }
    .message { margin-bottom: 8px; }
    .message.user { color: #0f0; }
    .message.tutor { color: #09f; }
    #typingIndicator {
      font-style: italic; font-size: 0.85rem; color: #aaa; padding-left: 10px; height: 20px;
    }
    #chatInputContainer {
      display: flex; border-top: 1px solid #333;
    }
    #chatInput {
      flex: 1; border: none; padding: 8px 10px; font-size: 1rem; background: #222; color: white;
    }
    #chatInput:focus { outline: none; }
    #chatSendBtn {
      background: #09f; border: none; color: white; padding: 0 15px; cursor: pointer;
    }
    #chatSendBtn:hover { background: #06c; }

    .toolPanel {
      flex: 1; display: none; height: 100%;
    }
    .toolPanel.active {
      display: block;
    }
    textarea, #whiteboard {
      width: 100%; height: 100%;
      border-radius: 5px; border: 1px solid #ccc;
      font-family: monospace; font-size: 1rem; resize: none;
    }
    #whiteboard {
      cursor: crosshair; background: white;
    }
  </style>
</head>
<body>
<header>CS Tutoring 24/7 - Sectioned Layout</header>

<div id="container">
  <nav id="sidebar">
    <button id="btnWhiteboard" class="active">Whiteboard</button>
    <button id="btnCodeEditor">Code Editor</button>
    <button id="btnTextEditor">Text Editor</button>
  </nav>

  <main id="mainContent">
    <div id="whiteboardPanel" class="toolPanel active">
      <canvas id="whiteboard"></canvas>
    </div>
    <div id="codeEditorPanel" class="toolPanel">
      <textarea id="codeEditor" spellcheck="false" placeholder="// Type your code here..."></textarea>
    </div>
    <div id="textEditorPanel" class="toolPanel">
      <textarea id="textEditor" placeholder="Write notes here..."></textarea>
    </div>
  </main>
</div>

<!-- Video Call + Chat -->
<div id="videoChatContainer">
  <div id="videoContainer">
    <video id="localVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
  </div>
  <div id="chatContainer">
    <div id="chatMessages"></div>
    <div id="typingIndicator"></div>
    <div id="chatInputContainer">
      <input type="text" id="chatInput" placeholder="Type a message..." />
      <button id="chatSendBtn">Send</button>
    </div>
  </div>
</div>

<!-- Socket.IO + WebRTC + App Logic -->
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
  const socket = io('http://localhost:3000'); // replace with your server
  const roomId = 'cs-tutoring-room';

  socket.emit('join-room', roomId);

  // Panel switching
  const btnWhiteboard = document.getElementById('btnWhiteboard');
  const btnCodeEditor = document.getElementById('btnCodeEditor');
  const btnTextEditor = document.getElementById('btnTextEditor');

  const whiteboardPanel = document.getElementById('whiteboardPanel');
  const codeEditorPanel = document.getElementById('codeEditorPanel');
  const textEditorPanel = document.getElementById('textEditorPanel');

  function setActivePanel(panelId) {
    [whiteboardPanel, codeEditorPanel, textEditorPanel].forEach(panel => panel.classList.remove('active'));
    [btnWhiteboard, btnCodeEditor, btnTextEditor].forEach(btn => btn.classList.remove('active'));
    if (panelId === 'whiteboard') {
      whiteboardPanel.classList.add('active');
      btnWhiteboard.classList.add('active');
      resizeCanvas();
    } else if (panelId === 'codeEditor') {
      codeEditorPanel.classList.add('active');
      btnCodeEditor.classList.add('active');
    } else if (panelId === 'textEditor') {
      textEditorPanel.classList.add('active');
      btnTextEditor.classList.add('active');
    }
  }

  btnWhiteboard.onclick = () => setActivePanel('whiteboard');
  btnCodeEditor.onclick = () => setActivePanel('codeEditor');
  btnTextEditor.onclick = () => setActivePanel('textEditor');

  // WebRTC
  const localVideo = document.getElementById('localVideo');
  const remoteVideo = document.getElementById('remoteVideo');
  let pc;

  async function startWebRTC() {
    pc = new RTCPeerConnection();

    pc.onicecandidate = event => {
      if (event.candidate) {
        socket.emit('signal', { roomId, data: { candidate: event.candidate } });
      }
    };

    pc.ontrack = event => {
      remoteVideo.srcObject = event.streams[0];
    };

    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    localVideo.srcObject = stream;
    stream.getTracks().forEach(track => pc.addTrack(track, stream));

    socket.on('signal', async ({ data }) => {
      if (data.sdp) {
        await pc.setRemoteDescription(new RTCSessionDescription(data.sdp));
        if (data.sdp.type === 'offer') {
          const answer = await pc.createAnswer();
          await pc.setLocalDescription(answer);
          socket.emit('signal', { roomId, data: { sdp: pc.localDescription } });
        }
      } else if (data.candidate) {
        await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
      }
    });

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    socket.emit('signal', { roomId, data: { sdp: pc.localDescription } });
  }

  startWebRTC();

  // Code Editor
  const codeEditor = document.getElementById('codeEditor');
  codeEditor.addEventListener('input', () => {
    socket.emit('code-change', { roomId, code: codeEditor.value });
  });
  socket.on('code-change', data => {
    if (codeEditor.value !== data) codeEditor.value




